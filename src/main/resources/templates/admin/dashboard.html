<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Admin Statistics</title>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/style/dashboard.css">
<script src="//code.jquery.com/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/latest/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
<div class="container-scroller">
<!-- ì‚¬ì´ë“œë°” -->
	<nav id="sidebar-all">
        <ul class="sidebar">
            <li class="sidebar-user">
                Ketchby
            </li>
            <li><a href="/admin/dashboard" id="dashboard">ğŸ“Š Dashboard</a></li>
            <li><a href="/admin/user" id="user">ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬</a></li>
            <li><a href="/admin/qanda" id="qanda">ğŸ“§ ë¬¸ì˜ ê´€ë¦¬</a></li>
            <li><a href="/admin/notification" id="notification">ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</a></li>
			<li class="has-submenu">
			    <a href="#" id="class">ğŸ“‘ í´ë˜ìŠ¤ ê´€ë¦¬</a>
			    <ul class="submenu">
			        <li><a href="/admin/class">ê¸°ì¡´ í´ë˜ìŠ¤</a></li>
			        <li><a href="/admin/classPending">ìŠ¹ì¸ ìš”ì²­ëœ í´ë˜ìŠ¤</a></li>
			    </ul>
			</li>                
			<li><a href="/admin/community" id="community">ğŸ§¾ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬</a></li>
        </ul>
    </nav>  
    
    <div id="page" class="page">
        <!-- ë³¸ë¬¸ í—¤ë”-->
        <div id="page-header">
        </div>

        <!-- ë³¸ë¬¸ ë©”ì¸-->
        <div class="main-wrapper">
             <div class="row">
                <div class="stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-title">
                                <h5>ì´ ì‚¬ìš©ì ìˆ˜</h5>
                                <p>user</p>
                            </div>
                            <div class="card-content">
                                <h2 th:text="${totalUsers}"></h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stretch-card">
                    <div class="card">
                        <div class="card-body">

                        </div>
                    </div>
                </div>
                <div class="stretch-card">
                    <div class="card">
                        <div class="card-body">

                        </div>
                    </div>
                </div>
                <div class="stretch-card">
                    <div class="card">
                        <div class="card-body">

                        </div>
                    </div>
                </div>
            </div>
            <!--ì‹ ê·œ ê°€ì…ì ì°¨íŠ¸-->
            <div class="chart-wrapper">
               <h2>ì¼ë³„ ì‹ ê·œ ì‚¬ìš©ì</h2>
                <div class="chart-controls">
                    <input type="date" id="startDate" name="startDate">-
                    <input type="date" id="endDate" name="endDate">

                    <button onclick="dailyUsersData()" id="btnSelect">ì„ íƒ</button>
                </div>
                <div class="chart-container">
                    <canvas id="dailyUsersChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!--ì‹ ê·œ ê°€ì…ì ìˆ˜ ì°¨íŠ¸-->
<script type="text/javascript">
    var dailyUsersChart = null;

    function createDailyUsersChart(labels, values) {
        var ctx = document.getElementById('dailyUsersChart').getContext('2d');
        
		//ì°¨íŠ¸ê°€ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë³€ê²½ë  ë•Œ ê¸°ì¡´ ì°¨íŠ¸ ì§€ìš°ê³  ìƒˆë¡œ ë®ì–´ì”€
        if (dailyUsersChart) {
            dailyUsersChart.destroy(); // Destroy the previous chart if it exists
        }
		
		
		// ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        dailyUsersChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ì¼ë³„ ì‹ ê·œ ê°€ì…ììˆ˜',
                    data: values,
                    backgroundColor: 'rgba(0, 131, 117, 0.2)', 
            		borderColor: 'rgba(0, 131, 117, 1)', 
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day',
                            displayFormats: {
                                day: 'MM-dd',
                            },
                        },
                        title: {
                            display: true,
                            text: 'Date',
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Number of New Users',
                        },
                    },
                },
            },
        });
    }

    function dailyUsersData() {
        var startDate = document.getElementById("startDate").value;
        var endDate = document.getElementById("endDate").value;
        
        console.log("startDate:", startDate);
    	console.log("endDate:", endDate);

        $.ajax({
            url: "/admin/dailyUsers?startDate=" + startDate + "&endDate=" + endDate,
            type: "GET",
            dataType: "json",
            success: function (data) {
                // Extract labels and values from the data
                var labels = data.map(item => item.regdate);
                var values = data.map(item => item.countaid);

                // Convert count values from string to integers
                values = values.map(value => parseInt(value, 10));

                console.log("Labels:", labels);
                console.log("Values:", values);

                // Call the function to update the chart with the fetched data
                createDailyUsersChart(labels, values);
            },
            error: function (error) {
                console.log("An error occurred:", error);
            }
        });
    }

    // Initial chart creation on page load
    dailyUsersData();

</script>

</body>
</html>